import type { FindingTemplate } from '../../constants';

export const authenticationTemplates: FindingTemplate[] = [
    {
        id: 'auth-brute-force',
        title: 'Brute Force Attack — No Account Lockout',
        category: 'Authentication',
        severity: 'High',
        cwe: 'CWE-307',
        cvss: '7.5',
        owasp: 'A07:2021 Identification and Authentication Failures',
        url: '/login',
        method: 'POST',
        tags: ['brute-force', 'authentication', 'password', 'lockout', 'rate-limiting'],
        description: '<p>The application does not implement account lockout or rate limiting mechanisms on its authentication endpoints. This allows an attacker to perform unlimited login attempts against user accounts, systematically trying different passwords until a valid combination is found.</p><p>Automated tools such as Hydra, Burp Suite Intruder, or custom scripts can attempt thousands of passwords per minute against the login endpoint. Without throttling or lockout mechanisms, weak or commonly-used passwords can be compromised in minutes.</p><p>Testing confirmed that hundreds of consecutive failed login attempts against a single account did not trigger any lockout, CAPTCHA challenge, or rate-limiting response.</p>',
        impact: '<p>Lack of brute force protection has serious security implications:</p><ul><li><strong>Account Compromise:</strong> Attackers can systematically crack weak user passwords, gaining unauthorized access to accounts.</li><li><strong>Credential Stuffing:</strong> Using leaked credential databases from other breaches, attackers can test username/password pairs at scale to identify valid credentials.</li><li><strong>Administrative Access:</strong> If admin accounts use weak passwords, brute force can lead to full application takeover.</li><li><strong>Resource Exhaustion:</strong> High-volume authentication attempts can degrade application performance and consume server resources.</li></ul>',
        remediation: '<p>Implement multiple layers of brute force protection:</p><ol><li><strong>Account Lockout:</strong> Lock accounts after 5-10 consecutive failed login attempts. Implement progressive lockout durations (e.g., 5 minutes after 5 failures, 30 minutes after 10, permanent lockout after 20 requiring admin intervention).</li><li><strong>Rate Limiting:</strong> Implement rate limiting on authentication endpoints based on IP address and username. Allow a maximum of 10-20 attempts per minute per IP address.</li><li><strong>CAPTCHA:</strong> Introduce CAPTCHA challenges after 3-5 failed login attempts to prevent automated attacks.</li><li><strong>Multi-Factor Authentication:</strong> Require MFA for all users, especially administrative accounts. Even if passwords are compromised, MFA prevents unauthorized access.</li><li><strong>Monitoring and Alerting:</strong> Log all failed authentication attempts and configure alerts for anomalous patterns (e.g., many failures from a single IP or against a single account).</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 - A07:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/307.html">CWE-307: Improper Restriction of Excessive Authentication Attempts</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html">OWASP Authentication Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'auth-weak-password-policy',
        title: 'Weak Password Policy',
        category: 'Authentication',
        severity: 'Medium',
        cwe: 'CWE-521',
        cvss: '5.3',
        owasp: 'A07:2021 Identification and Authentication Failures',
        url: '/register',
        method: 'POST',
        tags: ['password', 'policy', 'authentication', 'complexity'],
        description: '<p>The application\'s password policy does not enforce sufficient complexity requirements, allowing users to set weak or easily guessable passwords. During testing, the application accepted passwords that fail to meet industry-standard minimum requirements, such as short passwords, dictionary words, commonly-used passwords, or passwords without character diversity.</p><p>A weak password policy significantly increases the risk of successful brute force attacks, credential stuffing, and password guessing. According to NIST SP 800-63B guidelines, passwords should be at least 8 characters long and checked against known compromised password lists.</p><p>Testing confirmed that the application accepted passwords such as simple dictionary words, sequential characters, or passwords shorter than 8 characters.</p>',
        impact: '<p>Weak password policies undermine the entire authentication security model:</p><ul><li><strong>Easy Account Compromise:</strong> Weak passwords can be cracked through brute force or dictionary attacks in seconds to minutes.</li><li><strong>Credential Reuse Risk:</strong> Users with weak passwords on this system likely use similar weak passwords on other systems, amplifying breach impact.</li><li><strong>Compliance Failures:</strong> Most security frameworks (PCI-DSS, SOC 2, ISO 27001) require minimum password complexity standards.</li></ul>',
        remediation: '<p>Implement a robust password policy following NIST SP 800-63B guidelines:</p><ol><li><strong>Minimum Length:</strong> Require a minimum of 12 characters for standard accounts and 16 for administrative accounts.</li><li><strong>Breached Password Check:</strong> Check new passwords against known compromised password databases (e.g., Have I Been Pwned API\'s Pwned Passwords service).</li><li><strong>Block Common Passwords:</strong> Maintain a blocklist of the top 10,000 most common passwords and reject them during registration and password change.</li><li><strong>Password Strength Meter:</strong> Display a real-time password strength indicator during registration to guide users toward stronger passwords.</li><li><strong>Avoid Unnecessary Complexity Rules:</strong> Per NIST guidelines, avoid forcing specific character class requirements (uppercase, symbol, etc.) as they lead to predictable patterns. Focus on length and uniqueness instead.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 - A07:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/521.html">CWE-521: Weak Password Requirements</a></li><li><a href="https://pages.nist.gov/800-63-3/sp800-63b.html">NIST SP 800-63B Digital Identity Guidelines</a></li></ul></p>',
    },
    {
        id: 'auth-session-fixation',
        title: 'Session Fixation',
        category: 'Authentication',
        severity: 'High',
        cwe: 'CWE-384',
        cvss: '7.5',
        owasp: 'A07:2021 Identification and Authentication Failures',
        url: '/login',
        method: 'POST',
        tags: ['session', 'fixation', 'authentication', 'cookie'],
        description: '<p>The application does not regenerate the session identifier after successful authentication. This allows an attacker to perform a session fixation attack by setting a known session ID for the victim (through URL manipulation, cookie injection, or cross-site scripting) before the victim authenticates.</p><p>When the victim subsequently logs in using the attacker-controlled session ID, the session becomes authenticated while remaining accessible to the attacker. The attacker can then use this session ID to impersonate the authenticated victim without knowing their credentials.</p><p>Testing confirmed that the session token assigned before authentication remains valid and unchanged after successful login, enabling session fixation attacks.</p>',
        impact: '<p>Session fixation enables account impersonation:</p><ul><li><strong>Account Takeover:</strong> The attacker gains authenticated access to the victim\'s account using the fixed session ID.</li><li><strong>Unauthorized Actions:</strong> All actions performed during the session (data access, transactions, settings changes) can be performed by the attacker.</li><li><strong>Bypass of Authentication Logging:</strong> The attack may not appear in audit logs as a suspicious login since the victim performed a legitimate authentication.</li></ul>',
        remediation: '<p>To prevent session fixation:</p><ol><li><strong>Regenerate Session on Login:</strong> Always generate a new session identifier immediately after successful authentication. Invalidate the old session completely.</li><li><strong>Regenerate on Privilege Changes:</strong> Regenerate session IDs whenever the user\'s privilege level changes (e.g., after MFA verification, role elevation).</li><li><strong>Reject External Session IDs:</strong> Do not accept session identifiers from URL parameters or POST data. Only accept session IDs from secure cookies.</li><li><strong>Set Secure Cookie Attributes:</strong> Configure session cookies with <code>Secure</code>, <code>HttpOnly</code>, and <code>SameSite=Strict</code> or <code>SameSite=Lax</code> flags.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 - A07:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/384.html">CWE-384: Session Fixation</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html">OWASP Session Management Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'auth-jwt-weak-secret',
        title: 'JWT Weak Signing Secret',
        category: 'Authentication',
        severity: 'Critical',
        cwe: 'CWE-347',
        cvss: '9.1',
        owasp: 'A07:2021 Identification and Authentication Failures',
        url: '/api/auth',
        method: 'POST',
        tags: ['jwt', 'token', 'authentication', 'secret', 'signing'],
        description: '<p>The application uses JSON Web Tokens (JWT) for authentication but signs them with a weak, guessable, or default secret key. Common weak secrets include dictionary words, short strings, default values like "secret", "key", or the application name. These can be cracked using brute force tools like <code>jwt_tool</code> or <code>hashcat</code>.</p><p>Once the signing secret is known, an attacker can forge arbitrary JWT tokens with any claims — including modifying the user ID, role, and permissions fields — effectively gaining full control over the authentication system.</p><p>Testing confirmed that the JWT signing secret could be determined through offline brute force, allowing the creation of valid tokens for any user or role.</p>',
        impact: '<p>A compromised JWT secret undermines the entire authentication system:</p><ul><li><strong>Universal Authentication Bypass:</strong> The attacker can create valid tokens for any user account, including administrators.</li><li><strong>Undetectable Impersonation:</strong> Forged tokens are indistinguishable from legitimate ones, making detection extremely difficult.</li><li><strong>Privilege Escalation:</strong> Tokens can be forged with elevated roles and permissions.</li><li><strong>Token Longevity:</strong> Forged tokens remain valid until either the signing secret is changed or the tokens expire, potentially affecting users for extended periods.</li></ul>',
        remediation: '<p>To secure JWT implementations:</p><ol><li><strong>Strong Random Secret:</strong> Use a cryptographically random secret of at least 256 bits (32 bytes). Generate it using a CSPRNG (e.g., <code>openssl rand -hex 32</code>).</li><li><strong>Use Asymmetric Signing:</strong> Consider using RS256 or ES256 algorithms with public/private key pairs instead of symmetric HMAC secrets. This allows token verification without exposing the signing key.</li><li><strong>Secret Rotation:</strong> Implement a key rotation strategy. Periodically rotate signing secrets and support multiple valid keys during the transition period.</li><li><strong>Short Expiration:</strong> Set short token expiration times (15 minutes for access tokens). Use refresh tokens for session continuity.</li><li><strong>Validate Algorithm:</strong> Explicitly specify and validate the expected signing algorithm on the server side. Reject tokens using the "none" algorithm or unexpected algorithms.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">OWASP Top 10 - A07:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/347.html">CWE-347: Improper Verification of Cryptographic Signature</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html">OWASP JWT Cheat Sheet</a></li><li><a href="https://portswigger.net/web-security/jwt">PortSwigger - JWT Attacks</a></li></ul></p>',
    },
];
