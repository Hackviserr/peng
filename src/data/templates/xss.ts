import type { FindingTemplate } from '../../constants';

export const xssTemplates: FindingTemplate[] = [
    {
        id: 'xss-reflected',
        title: 'Cross-Site Scripting (Reflected)',
        category: 'XSS',
        severity: 'High',
        cwe: 'CWE-79',
        cvss: '7.1',
        owasp: 'A07:2021 XSS',
        url: '/search?q=test',
        method: 'GET',
        parameter: 'q',
        tags: ['xss', 'reflected', 'javascript', 'client-side'],
        description: '<p>The application reflects user-supplied input in its HTTP responses without adequate sanitization or output encoding. This allows an attacker to craft malicious URLs containing JavaScript code that executes in the victim\'s browser when they click the link.</p><p>Reflected XSS requires social engineering to deliver the malicious URL to the victim (e.g., via phishing emails, forum posts, or instant messages). Once the victim visits the crafted URL, the injected script executes within the context of the vulnerable application, with full access to the victim\'s session, cookies, and DOM.</p><p>Testing confirmed that injecting HTML/JavaScript payloads through the identified parameter results in the payload being reflected in the response and executed by the browser without encoding.</p>',
        impact: '<p>Reflected XSS can lead to severe security consequences:</p><ul><li><strong>Session Hijacking:</strong> The injected script can steal the victim\'s session cookie and transmit it to an attacker-controlled server, allowing the attacker to impersonate the victim.</li><li><strong>Credential Theft:</strong> The attacker can inject a fake login form or keylogger to capture the victim\'s credentials.</li><li><strong>Phishing:</strong> The malicious script can modify the page content to display convincing phishing content within the trusted domain context.</li><li><strong>Malware Distribution:</strong> The victim\'s browser can be redirected to malware-serving sites or exploit kit landing pages.</li><li><strong>Unauthorized Actions:</strong> The script can perform actions on behalf of the authenticated victim, such as changing account settings, making purchases, or transferring funds.</li></ul>',
        remediation: '<p>To prevent Reflected XSS:</p><ol><li><strong>Context-Aware Output Encoding:</strong> All user input rendered in HTML responses must be encoded based on the output context (HTML body, HTML attribute, JavaScript, CSS, or URL). Use established encoding libraries rather than custom implementations.</li><li><strong>Content Security Policy (CSP):</strong> Implement a strict CSP header that prevents inline script execution: <code>Content-Security-Policy: default-src \'self\'; script-src \'self\'</code>. This provides defense-in-depth even if encoding is missed.</li><li><strong>HttpOnly Cookies:</strong> Set the <code>HttpOnly</code> flag on session cookies to prevent JavaScript access, mitigating session hijacking via XSS.</li><li><strong>Input Validation:</strong> Validate user input against expected patterns on the server side. Reject input containing HTML tags and JavaScript event handlers where not expected.</li><li><strong>Use Modern Frameworks:</strong> Leverage frameworks like React, Angular, or Vue that automatically encode output by default. Avoid using <code>dangerouslySetInnerHTML</code> or <code>v-html</code> with user input.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Cross-Site_Scripting/">OWASP Top 10 - A07:2021 XSS</a></li><li><a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: Improper Neutralization of Input During Web Page Generation</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">OWASP XSS Prevention Cheat Sheet</a></li><li><a href="https://portswigger.net/web-security/cross-site-scripting/reflected">PortSwigger - Reflected XSS</a></li></ul></p>',
    },
    {
        id: 'xss-stored',
        title: 'Cross-Site Scripting (Stored/Persistent)',
        category: 'XSS',
        severity: 'High',
        cwe: 'CWE-79',
        cvss: '8.1',
        owasp: 'A07:2021 XSS',
        url: '/api/comments',
        method: 'POST',
        parameter: 'comment',
        tags: ['xss', 'stored', 'persistent', 'javascript'],
        description: '<p>The application stores user-supplied input (e.g., in a database, file, or message queue) and later renders it in web pages served to other users without adequate output encoding. This is the most dangerous variant of XSS because the malicious payload is permanently stored and automatically delivered to every user who views the affected content.</p><p>Unlike reflected XSS, stored XSS does not require social engineering â€” any user who visits the page containing the stored payload will be affected. Common injection points include user profiles, comments, forum posts, product reviews, chat messages, and any other user-generated content areas.</p><p>Testing confirmed that injected script payloads were stored by the application and subsequently rendered without encoding, executing in the browsers of other users viewing the affected content.</p>',
        impact: '<p>Stored XSS has an amplified impact compared to reflected XSS:</p><ul><li><strong>Mass User Compromise:</strong> Every user who views the affected content is automatically attacked, potentially compromising hundreds or thousands of accounts.</li><li><strong>Worm Propagation:</strong> Stored XSS payloads can be designed to self-replicate, automatically posting the malicious content from each compromised user\'s account (as seen in the Samy worm on MySpace).</li><li><strong>Session Hijacking at Scale:</strong> The attacker can harvest session tokens from all affected users, enabling mass account takeover.</li><li><strong>Persistent Backdoor:</strong> The stored payload continues to execute until it is identified and removed from the database, providing persistent attack capability.</li><li><strong>Privilege Escalation:</strong> If an administrator views the stored payload, the attacker gains administrative session access.</li></ul>',
        remediation: '<p>Stored XSS requires all the same defenses as reflected XSS, plus additional measures:</p><ol><li><strong>Output Encoding on Render:</strong> Encode all stored user content at the point of rendering, not at the point of storage. This ensures all output contexts are handled correctly.</li><li><strong>HTML Sanitization:</strong> If rich HTML content is required (e.g., in a WYSIWYG editor), use a well-tested HTML sanitizer library like DOMPurify (JavaScript) or Bleach (Python) to strip dangerous elements and attributes.</li><li><strong>Content Security Policy:</strong> Deploy a strict CSP that blocks inline scripts and restricts script sources. Use nonce-based CSP for dynamic script loading.</li><li><strong>Database Audit:</strong> After fixing the vulnerability, audit existing database records for previously injected payloads and sanitize them.</li><li><strong>Input Length Limits:</strong> Enforce reasonable length limits on user input fields to reduce the attack surface for complex payloads.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Cross-Site_Scripting/">OWASP Top 10 - A07:2021 XSS</a></li><li><a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: XSS</a></li><li><a href="https://portswigger.net/web-security/cross-site-scripting/stored">PortSwigger - Stored XSS</a></li></ul></p>',
    },
    {
        id: 'xss-dom',
        title: 'Cross-Site Scripting (DOM-Based)',
        category: 'XSS',
        severity: 'High',
        cwe: 'CWE-79',
        cvss: '7.1',
        owasp: 'A07:2021 XSS',
        url: '/page#section',
        method: 'GET',
        parameter: 'hash fragment',
        tags: ['xss', 'dom', 'javascript', 'client-side', 'sink', 'source'],
        description: '<p>The application contains client-side JavaScript code that processes user-controllable data (a "source") and passes it to a dangerous function (a "sink") that dynamically updates the page DOM. This vulnerability exists entirely in the client-side code and does not require any interaction with the server.</p><p>Common DOM XSS sources include <code>document.location</code>, <code>document.referrer</code>, <code>window.name</code>, <code>location.hash</code>, and <code>postMessage</code> data. Dangerous sinks include <code>innerHTML</code>, <code>outerHTML</code>, <code>document.write()</code>, <code>eval()</code>, <code>setTimeout()</code> with string arguments, and jQuery methods like <code>.html()</code>.</p><p>Testing identified a code path where data from the URL fragment or query string is processed by client-side JavaScript and inserted into the DOM via a dangerous sink without sanitization, enabling script execution.</p>',
        impact: '<p>DOM-based XSS carries similar risks to other XSS variants:</p><ul><li><strong>Session Theft:</strong> Attackers can steal session tokens and authentication cookies.</li><li><strong>WAF Bypass:</strong> Because the payload is processed entirely in the client\'s browser and may never be sent to the server (e.g., when using URL fragments), server-side security controls and WAFs cannot detect or block the attack.</li><li><strong>Credential Harvesting:</strong> Injected scripts can create fake login forms or capture keystrokes.</li><li><strong>Content Manipulation:</strong> The page content can be modified to display false information, redirect users, or deface the application.</li></ul>',
        remediation: '<p>DOM-based XSS requires client-side code remediation:</p><ol><li><strong>Avoid Dangerous Sinks:</strong> Replace <code>innerHTML</code> with <code>textContent</code> or <code>innerText</code> when inserting text content. Use DOM APIs like <code>createElement()</code> and <code>setAttribute()</code> instead of string-based HTML construction.</li><li><strong>Sanitize Before Sink:</strong> If HTML insertion is necessary, sanitize user data using DOMPurify before passing it to DOM manipulation functions.</li><li><strong>Use Trusted Types:</strong> Implement the Trusted Types API (supported in Chromium browsers) to enforce type-safe handling of DOM operations: <code>Content-Security-Policy: require-trusted-types-for \'script\'</code>.</li><li><strong>Code Review:</strong> Audit all client-side JavaScript for source-to-sink data flows using static analysis tools such as ESLint security plugins or Semgrep rules.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A07_2021-Cross-Site_Scripting/">OWASP Top 10 - A07:2021 XSS</a></li><li><a href="https://cwe.mitre.org/data/definitions/79.html">CWE-79: XSS</a></li><li><a href="https://portswigger.net/web-security/cross-site-scripting/dom-based">PortSwigger - DOM-Based XSS</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">OWASP DOM-Based XSS Prevention Cheat Sheet</a></li></ul></p>',
    },
];
