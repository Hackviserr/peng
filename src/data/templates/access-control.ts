import type { FindingTemplate } from '../../constants';

export const accessControlTemplates: FindingTemplate[] = [
    {
        id: 'ac-idor',
        title: 'Insecure Direct Object Reference (IDOR)',
        category: 'Broken Access Control',
        severity: 'High',
        cwe: 'CWE-639',
        cvss: '7.5',
        owasp: 'A01:2021 Broken Access Control',
        url: '/api/users/123/profile',
        method: 'GET',
        parameter: 'id',
        tags: ['idor', 'access-control', 'authorization', 'object-reference'],
        description: '<p>The application exposes internal object references (such as database record IDs, filenames, or sequential identifiers) in URLs, form parameters, or API endpoints, and fails to verify that the requesting user is authorized to access the referenced object. By manipulating these identifiers, an attacker can access or modify resources belonging to other users.</p><p>IDOR vulnerabilities commonly appear in endpoints like <code>/api/users/123/profile</code>, <code>/invoice/download?id=456</code>, or <code>/order/789</code>, where changing the numeric ID grants access to another user\'s data. This applies to both read operations (viewing other users\' data) and write operations (modifying or deleting their resources).</p><p>During testing, it was confirmed that modifying object reference parameters in authenticated requests allowed access to resources belonging to other users without authorization checks.</p>',
        impact: '<p>IDOR vulnerabilities can have significant impact on data confidentiality and integrity:</p><ul><li><strong>Unauthorized Data Access:</strong> Attackers can view sensitive information belonging to other users, including personal profiles, financial records, medical data, and private communications.</li><li><strong>Data Modification:</strong> If write operations are affected, attackers can modify other users\' data, change account settings, or alter transaction records.</li><li><strong>Mass Data Harvesting:</strong> Sequential or predictable identifiers enable automated enumeration and mass extraction of all records in the system.</li><li><strong>Account Takeover:</strong> If password reset tokens, email change functions, or API keys are accessible via IDOR, attackers can take over other accounts.</li><li><strong>Regulatory Violations:</strong> Unauthorized access to personal data violates GDPR, KVKK, HIPAA, and other data protection regulations.</li></ul>',
        remediation: '<p>To prevent IDOR vulnerabilities:</p><ol><li><strong>Server-Side Authorization Checks:</strong> Every data access operation must verify that the authenticated user has permission to access the requested resource. Check ownership or role-based permissions on every request, not just at the UI level.</li><li><strong>Use Indirect References:</strong> Map internal database IDs to per-session random tokens or UUIDs that are not guessable. The mapping is maintained server-side and validated on each request.</li><li><strong>Implement Access Control Middleware:</strong> Create reusable authorization middleware that intercepts all data access requests and validates user permissions before processing.</li><li><strong>Avoid Sequential IDs:</strong> Use UUIDs or random identifiers instead of auto-incrementing integers for resource references exposed to clients.</li><li><strong>Logging and Monitoring:</strong> Log all access control decisions and monitor for patterns indicating IDOR exploitation, such as a single user accessing many different user resources.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 - A01:2021 Broken Access Control</a></li><li><a href="https://cwe.mitre.org/data/definitions/639.html">CWE-639: Authorization Bypass Through User-Controlled Key</a></li><li><a href="https://portswigger.net/web-security/access-control/idor">PortSwigger - IDOR</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html">OWASP IDOR Prevention Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'ac-priv-esc-vertical',
        title: 'Vertical Privilege Escalation',
        category: 'Broken Access Control',
        severity: 'Critical',
        cwe: 'CWE-269',
        cvss: '8.8',
        owasp: 'A01:2021 Broken Access Control',
        url: '/api/admin/users',
        method: 'POST',
        tags: ['privilege-escalation', 'vertical', 'authorization', 'admin', 'rbac'],
        description: '<p>The application fails to enforce role-based access controls on administrative or privileged functionality, allowing a lower-privileged user to access features intended for higher-privilege roles (e.g., a regular user accessing admin panels, modifying system configurations, or managing other user accounts).</p><p>This vulnerability typically occurs when access control is enforced only at the UI level (hiding menu items or buttons) but not on the server-side endpoints. An attacker can directly call administrative API endpoints or navigate to admin URLs to perform privileged operations.</p><p>Testing revealed that a standard user account could access administrative endpoints by directly requesting protected URLs or API routes, bypassing client-side access control restrictions.</p>',
        impact: '<p>Vertical privilege escalation represents a critical security failure:</p><ul><li><strong>Administrative Takeover:</strong> Attackers can gain full administrative control over the application, including user management, system configuration, and data access.</li><li><strong>Data Breach:</strong> Administrative access typically grants unrestricted access to all user data and system information.</li><li><strong>System Compromise:</strong> Admin functions may include file upload, code execution, or database management capabilities that enable server compromise.</li><li><strong>Compliance Violation:</strong> Inadequate access controls violate requirements in PCI-DSS, SOC 2, ISO 27001, and other compliance frameworks.</li></ul>',
        remediation: '<p>To prevent vertical privilege escalation:</p><ol><li><strong>Server-Side Role Verification:</strong> Implement role-based access control (RBAC) checks on every server-side endpoint. Verify the authenticated user\'s role before processing any request to privileged functionality.</li><li><strong>Centralized Access Control:</strong> Use a centralized authorization framework or middleware that enforces access policies consistently across all endpoints.</li><li><strong>Deny by Default:</strong> Configure access control to deny all requests by default, only allowing access to resources and operations explicitly permitted for the user\'s role.</li><li><strong>Separate Admin Interfaces:</strong> Consider hosting administrative interfaces on a separate domain or network segment with additional authentication requirements (e.g., VPN, IP allowlisting, MFA).</li><li><strong>Automated Testing:</strong> Include automated access control tests in CI/CD pipelines that verify lower-privileged users cannot access higher-privileged endpoints.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 - A01:2021 Broken Access Control</a></li><li><a href="https://cwe.mitre.org/data/definitions/269.html">CWE-269: Improper Privilege Management</a></li><li><a href="https://portswigger.net/web-security/access-control">PortSwigger - Access Control</a></li></ul></p>',
    },
    {
        id: 'ac-path-traversal',
        title: 'Path Traversal / Directory Traversal',
        category: 'Broken Access Control',
        severity: 'High',
        cwe: 'CWE-22',
        cvss: '7.5',
        owasp: 'A01:2021 Broken Access Control',
        url: '/api/files/download?file=report.pdf',
        method: 'GET',
        parameter: 'file',
        tags: ['path-traversal', 'directory-traversal', 'lfi', 'file-access'],
        description: '<p>The application uses user-supplied input to construct file paths for server-side file operations (reading, writing, or including files) without properly validating or sanitizing the input. By injecting path traversal sequences such as <code>../</code> (dot-dot-slash), an attacker can escape the intended directory and access arbitrary files on the server\'s filesystem.</p><p>Common vulnerable patterns include file download endpoints (<code>/download?file=report.pdf</code>), image serving (<code>/images?name=logo.png</code>), template inclusion, and log file viewers. The attacker can read sensitive files such as <code>/etc/passwd</code>, <code>/etc/shadow</code>, application configuration files, source code, and database files.</p><p>Testing confirmed that injecting <code>../</code> sequences into file path parameters allowed access to files outside the intended directory, including system configuration files.</p>',
        impact: '<p>Path traversal can expose critical system and application data:</p><ul><li><strong>Sensitive File Disclosure:</strong> Attackers can read system files (<code>/etc/passwd</code>, <code>/etc/shadow</code>), application source code, configuration files containing database credentials and API keys.</li><li><strong>Credential Theft:</strong> Configuration files often contain database connection strings, API tokens, and other secrets that enable further attacks.</li><li><strong>Source Code Exposure:</strong> Access to application source code reveals business logic, additional vulnerabilities, and intellectual property.</li><li><strong>Remote Code Execution:</strong> In some cases, path traversal combined with file write capabilities or log poisoning can lead to Remote Code Execution.</li></ul>',
        remediation: '<p>To prevent path traversal vulnerabilities:</p><ol><li><strong>Avoid User Input in File Paths:</strong> The most secure approach is to never use user input directly in file path construction. Map user requests to file references using an indirect mapping (e.g., a database lookup or allowlist of permitted files).</li><li><strong>Canonicalization:</strong> If user input must be used, resolve the canonical (absolute) path and verify it falls within the expected base directory before proceeding with the file operation.</li><li><strong>Input Validation:</strong> Reject input containing path traversal characters: <code>../</code>, <code>..\\</code>, <code>%2e%2e%2f</code>, and null bytes. Use allowlist validation to permit only expected characters (e.g., alphanumeric and limited special characters).</li><li><strong>Chroot/Sandbox:</strong> Run the application in a chrooted environment or container where filesystem access is restricted to the necessary directories.</li><li><strong>Least Privilege:</strong> Ensure the application process runs with minimal filesystem permissions.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 - A01:2021 Broken Access Control</a></li><li><a href="https://cwe.mitre.org/data/definitions/22.html">CWE-22: Path Traversal</a></li><li><a href="https://portswigger.net/web-security/file-path-traversal">PortSwigger - Path Traversal</a></li></ul></p>',
    },
    {
        id: 'ac-cors-misconfiguration',
        title: 'CORS Misconfiguration',
        category: 'Broken Access Control',
        severity: 'High',
        cwe: 'CWE-942',
        cvss: '7.5',
        owasp: 'A01:2021 Broken Access Control',
        url: '/api/user/profile',
        method: 'GET',
        tags: ['cors', 'cross-origin', 'misconfiguration', 'same-origin-policy'],
        description: '<p>The application\'s Cross-Origin Resource Sharing (CORS) policy is misconfigured, allowing unauthorized cross-origin requests from attacker-controlled domains. CORS is a browser mechanism that relaxes the Same-Origin Policy (SOP) to allow controlled cross-origin resource sharing.</p><p>Common misconfigurations include: reflecting the <code>Origin</code> header value in the <code>Access-Control-Allow-Origin</code> response without validation, using wildcard (<code>*</code>) with credentials, allowing <code>null</code> origin, and overly permissive domain patterns that can be bypassed.</p><p>Testing revealed that the application reflects arbitrary origin values or uses an overly permissive CORS policy, allowing an attacker-controlled website to make authenticated cross-origin requests and read the responses.</p>',
        impact: '<p>CORS misconfiguration enables cross-origin data theft:</p><ul><li><strong>Sensitive Data Theft:</strong> An attacker\'s website can make authenticated requests to the vulnerable application and read the responses, stealing user data, account information, and API responses.</li><li><strong>Session Riding:</strong> The attacker\'s site can perform state-changing operations (POST, PUT, DELETE) on behalf of the authenticated user.</li><li><strong>Token Extraction:</strong> CSRF tokens, API keys, and other security tokens exposed in API responses can be stolen cross-origin.</li><li><strong>Internal Network Scanning:</strong> If the victim has access to internal networks, CORS misconfiguration of internal applications can enable external attackers to access internal resources through the victim\'s browser.</li></ul>',
        remediation: '<p>To properly configure CORS:</p><ol><li><strong>Strict Origin Allowlist:</strong> Maintain an explicit allowlist of trusted origins. Never reflect arbitrary Origin headers. Validate the Origin header against the allowlist before setting <code>Access-Control-Allow-Origin</code>.</li><li><strong>Avoid Wildcards with Credentials:</strong> Never use <code>Access-Control-Allow-Origin: *</code> with <code>Access-Control-Allow-Credentials: true</code>. Browsers reject this combination, but proxy configurations may bypass this check.</li><li><strong>Reject Null Origin:</strong> Do not allow <code>null</code> as a permitted origin, as it can be triggered from sandboxed iframes and local file access.</li><li><strong>Minimize Exposed Headers:</strong> Only include necessary headers in <code>Access-Control-Expose-Headers</code>. Avoid exposing security-sensitive headers.</li><li><strong>Validate in Middleware:</strong> Implement CORS validation in a centralized middleware component to ensure consistent enforcement across all endpoints.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 - A01:2021 Broken Access Control</a></li><li><a href="https://cwe.mitre.org/data/definitions/942.html">CWE-942: Permissive CORS Policy</a></li><li><a href="https://portswigger.net/web-security/cors">PortSwigger - CORS</a></li></ul></p>',
    },
];
