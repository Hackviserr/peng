import type { FindingTemplate } from '../../constants';

export const misconfigurationTemplates: FindingTemplate[] = [
    {
        id: 'misc-debug-mode',
        title: 'Application Running in Debug/Development Mode',
        category: 'Security Misconfiguration',
        severity: 'High',
        cwe: 'CWE-489',
        cvss: '7.5',
        owasp: 'A05:2021 Security Misconfiguration',
        url: '/api/debug',
        method: 'GET',
        tags: ['debug', 'development', 'misconfiguration', 'stack-trace', 'verbose-errors'],
        description: '<p>The application is deployed in production with debug or development mode enabled. This typically exposes detailed error messages including stack traces, source code snippets, database query details, environment variables, and internal application configuration. Debug toolbars or interactive debuggers may also be accessible.</p><p>Common indicators include: Django debug pages, Laravel debug mode, Express.js verbose error handlers, ASP.NET detailed error pages, Spring Boot Actuator endpoints, and Werkzeug interactive debugger. These debugging features are designed exclusively for development use and provide attackers with critical information about the application\'s internal workings.</p><p>Testing confirmed that the application returns detailed technical error information in response to malformed requests, indicating an active debug or development configuration.</p>',
        impact: '<p>Debug mode in production creates multiple security risks:</p><ul><li><strong>Information Disclosure:</strong> Stack traces reveal source code file paths, function names, library versions, and error handling logic.</li><li><strong>Credential Exposure:</strong> Environment variables and configuration dumps may contain database credentials, API keys, and secret keys.</li><li><strong>Remote Code Execution:</strong> Some debug tools (e.g., Werkzeug debugger, Laravel Ignition) provide interactive code execution capabilities that can be exploited for full server compromise.</li><li><strong>Attack Surface Mapping:</strong> Detailed error information helps attackers understand the technology stack, identify additional vulnerabilities, and craft more targeted attacks.</li></ul>',
        remediation: '<p>Disable debug mode in all production environments:</p><ol><li><strong>Set Production Configuration:</strong> Ensure environment variables are set correctly: <code>DEBUG=false</code>, <code>NODE_ENV=production</code>, <code>FLASK_ENV=production</code>, <code>APP_DEBUG=false</code>.</li><li><strong>Custom Error Pages:</strong> Implement generic error pages (400, 403, 404, 500) that display user-friendly messages without technical details.</li><li><strong>Structured Logging:</strong> Log detailed error information to server-side log files (not to HTTP responses). Use centralized logging solutions like ELK Stack or Datadog.</li><li><strong>Remove Debug Endpoints:</strong> Remove or restrict access to debug endpoints such as <code>/debug</code>, <code>/__debug__/</code>, Spring Boot Actuator endpoints, and profiling tools.</li><li><strong>Configuration Audits:</strong> Include production configuration verification in deployment checklists and CI/CD pipelines.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 - A05:2021 Security Misconfiguration</a></li><li><a href="https://cwe.mitre.org/data/definitions/489.html">CWE-489: Active Debug Code</a></li></ul></p>',
    },
    {
        id: 'misc-directory-listing',
        title: 'Directory Listing Enabled',
        category: 'Security Misconfiguration',
        severity: 'Medium',
        cwe: 'CWE-548',
        cvss: '5.3',
        owasp: 'A05:2021 Security Misconfiguration',
        url: '/assets/',
        method: 'GET',
        tags: ['directory-listing', 'information-disclosure', 'web-server', 'apache', 'nginx'],
        description: '<p>The web server is configured to display the contents of directories that do not contain a default index file (e.g., index.html). When a user navigates to such a directory, the server returns an automatically generated listing of all files and subdirectories, including their names, sizes, and modification dates.</p><p>This misconfiguration is more common than expected, as many web servers enable directory listing by default. It can expose backup files, configuration files, source code, database dumps, temporary files, and other sensitive resources that were not intended to be publicly accessible.</p><p>Testing confirmed that navigating to directories without index files on the web server returns a directory listing showing file and folder names.</p>',
        impact: '<p>Directory listing exposes the application\'s internal file structure:</p><ul><li><strong>Sensitive File Discovery:</strong> Attackers can find backup files (.bak, .old, .sql), configuration files (.env, web.config), source code, and database dumps.</li><li><strong>Attack Surface Mapping:</strong> Complete knowledge of the directory structure helps attackers identify hidden endpoints, administrative interfaces, and development artifacts.</li><li><strong>Hidden Content Access:</strong> Files placed in web-accessible directories without link references become discoverable.</li></ul>',
        remediation: '<p>Disable directory listing on all web servers:</p><ol><li><strong>Apache:</strong> Add <code>Options -Indexes</code> in the server configuration or <code>.htaccess</code> file.</li><li><strong>Nginx:</strong> Ensure <code>autoindex off;</code> is set in the server block (this is the default).</li><li><strong>IIS:</strong> Disable "Directory Browsing" in the IIS Manager or via <code>web.config</code>.</li><li><strong>Default Index Files:</strong> Place a default index file (even a blank one) in every web-accessible directory as an additional safeguard.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 - A05:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/548.html">CWE-548: Exposure of Information Through Directory Listing</a></li></ul></p>',
    },
    {
        id: 'misc-default-credentials',
        title: 'Default Credentials in Use',
        category: 'Security Misconfiguration',
        severity: 'Critical',
        cwe: 'CWE-1392',
        cvss: '9.8',
        owasp: 'A05:2021 Security Misconfiguration',
        url: '/admin/login',
        method: 'POST',
        tags: ['default-credentials', 'password', 'admin', 'misconfiguration'],
        description: '<p>A system component (application, database, network device, or management interface) is accessible using its factory-default username and password combination. Commonly found defaults include admin/admin, admin/password, root/root, sa/(blank) for SQL Server, and vendor-specific defaults documented in product manuals.</p><p>Default credentials are publicly documented and included in automated scanning tools\' databases. Attackers routinely check for default credentials as one of the first steps in reconnaissance, making this one of the easiest vulnerabilities to exploit.</p><p>Testing confirmed that the identified service or interface accepted authentication using well-known default credentials, granting unauthorized access.</p>',
        impact: '<p>Default credentials provide immediate and often privileged access:</p><ul><li><strong>Complete System Compromise:</strong> Default credentials often grant administrative access, allowing full control over the affected system.</li><li><strong>Data Breach:</strong> Administrative access to databases, applications, or network devices exposes all stored data.</li><li><strong>Lateral Movement:</strong> Compromised administrative interfaces can be used to pivot to other systems in the network.</li><li><strong>Automated Exploitation:</strong> Botnets and automated scanners continuously probe for default credentials, making unprotected systems targets for automated attacks.</li></ul>',
        remediation: '<p>Eliminate all default credentials:</p><ol><li><strong>Change Immediately:</strong> Replace all default passwords with strong, unique credentials before deploying any system to production.</li><li><strong>Force Password Change:</strong> Configure systems to require a password change on first login.</li><li><strong>Credential Inventory:</strong> Maintain an inventory of all system components and their credential requirements. Include credential changes in deployment checklists.</li><li><strong>Automated Scanning:</strong> Include default credential checks in routine vulnerability scanning and penetration testing.</li><li><strong>Disable Unused Accounts:</strong> Remove or disable factory-default accounts that are not needed for operation.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 - A05:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/1392.html">CWE-1392: Use of Default Credentials</a></li></ul></p>',
    },
    {
        id: 'misc-missing-security-headers',
        title: 'Missing HTTP Security Headers',
        category: 'Security Misconfiguration',
        severity: 'Low',
        cwe: 'CWE-693',
        cvss: '4.3',
        owasp: 'A05:2021 Security Misconfiguration',
        url: '/',
        method: 'GET',
        tags: ['headers', 'security-headers', 'csp', 'hsts', 'x-frame-options'],
        description: '<p>The application\'s HTTP responses are missing several recommended security headers that provide defense-in-depth protection against common web attacks. These headers instruct the browser to enable or enforce security features.</p><p>The following security headers were found to be missing or misconfigured:</p><ul><li><code>Content-Security-Policy</code> — Prevents XSS, clickjacking, and other code injection attacks</li><li><code>X-Content-Type-Options</code> — Prevents MIME-type sniffing</li><li><code>X-Frame-Options</code> — Prevents clickjacking attacks</li><li><code>Strict-Transport-Security</code> — Enforces HTTPS connections</li><li><code>Referrer-Policy</code> — Controls referrer information leakage</li><li><code>Permissions-Policy</code> — Controls browser feature access</li></ul>',
        impact: '<p>Missing security headers reduce the application\'s defense-in-depth:</p><ul><li><strong>Increased XSS Impact:</strong> Without CSP, successful XSS attacks have unrestricted capabilities.</li><li><strong>Clickjacking:</strong> Without X-Frame-Options or CSP frame-ancestors, the application can be embedded in malicious iframes for clickjacking attacks.</li><li><strong>MITM Attacks:</strong> Without HSTS, users may be vulnerable to SSL stripping attacks on first visit.</li><li><strong>Information Leakage:</strong> Without Referrer-Policy, sensitive URL parameters may be leaked to third-party sites through the Referer header.</li></ul>',
        remediation: '<p>Add the following security headers to all HTTP responses:</p><ol><li><code>Content-Security-Policy: default-src \'self\'; script-src \'self\'; style-src \'self\' \'unsafe-inline\'; img-src \'self\' data:</code> — Customize based on application needs.</li><li><code>X-Content-Type-Options: nosniff</code></li><li><code>X-Frame-Options: DENY</code> or <code>SAMEORIGIN</code></li><li><code>Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</code></li><li><code>Referrer-Policy: strict-origin-when-cross-origin</code></li><li><code>Permissions-Policy: camera=(), microphone=(), geolocation=()</code></li><li><code>X-XSS-Protection: 0</code> — Disable legacy XSS filter (replaced by CSP)</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 - A05:2021</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html">OWASP HTTP Security Headers Cheat Sheet</a></li><li><a href="https://securityheaders.com/">SecurityHeaders.com Scanner</a></li></ul></p>',
    },
];
