import type { FindingTemplate } from '../../constants';

export const injectionTemplates: FindingTemplate[] = [
    {
        id: 'inj-sql-union',
        title: 'SQL Injection (Union-Based)',
        category: 'Injection',
        severity: 'Critical',
        cwe: 'CWE-89',
        cvss: '9.8',
        owasp: 'A03:2021 Injection',
        url: '/api/users?id=1',
        method: 'GET',
        parameter: 'id',
        tags: ['sql', 'injection', 'database', 'union', 'data-extraction'],
        description: '<p>The application constructs SQL queries using unsanitized user input, allowing an attacker to inject arbitrary SQL statements. Through UNION-based injection, the attacker can append additional SELECT statements to the original query, effectively reading data from any table in the database.</p><p>During testing, it was confirmed that user-controlled input is directly concatenated into SQL queries without parameterization or input validation. By crafting UNION SELECT payloads, the tester was able to enumerate database tables, extract column names, and retrieve sensitive records including user credentials and personal data.</p><p>This class of vulnerability is consistently ranked among the most critical web application security risks by OWASP and represents a direct path to full database compromise.</p>',
        impact: '<p>The impact of this vulnerability is severe and far-reaching:</p><ul><li><strong>Complete Data Breach:</strong> An attacker can extract the entire contents of the database, including user credentials, personal identifiable information (PII), financial records, and proprietary business data.</li><li><strong>Authentication Bypass:</strong> By extracting or manipulating credential data, the attacker can gain unauthorized access to any account, including administrative accounts.</li><li><strong>Regulatory Non-Compliance:</strong> A data breach resulting from SQL injection may trigger mandatory breach notifications and penalties under GDPR, KVKK, PCI-DSS, and HIPAA regulations.</li><li><strong>Reputational Damage:</strong> Public disclosure of a SQL injection vulnerability and subsequent data breach can severely damage customer trust and brand reputation.</li></ul>',
        remediation: '<p>The following measures should be implemented to remediate this vulnerability:</p><ol><li><strong>Use Parameterized Queries (Prepared Statements):</strong> All database interactions must use parameterized queries or prepared statements. This ensures user input is treated as data, never as executable SQL code. Example:<pre><code>// Vulnerable\nconst query = `SELECT * FROM users WHERE id = ${userId}`;\n\n// Secure\nconst query = \'SELECT * FROM users WHERE id = ?\';\ndb.execute(query, [userId]);</code></pre></li><li><strong>Implement an ORM:</strong> Use an Object-Relational Mapping (ORM) library such as Sequelize, TypeORM, or Prisma that inherently uses parameterized queries.</li><li><strong>Input Validation:</strong> Implement strict server-side input validation using allowlists. Reject any input that does not match expected patterns (e.g., numeric IDs should only contain digits).</li><li><strong>Least Privilege Database Access:</strong> The application\'s database user should have the minimum permissions required. Remove DELETE, DROP, and ALTER privileges unless explicitly needed.</li><li><strong>Web Application Firewall (WAF):</strong> Deploy a WAF with SQL injection detection rules as a defense-in-depth measure. Note that WAF alone is not sufficient.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: SQL Injection</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">OWASP SQL Injection Prevention Cheat Sheet</a></li><li><a href="https://portswigger.net/web-security/sql-injection/union-attacks">PortSwigger - SQL Injection UNION Attacks</a></li></ul></p>',
    },
    {
        id: 'inj-sql-blind-boolean',
        title: 'SQL Injection (Blind Boolean-Based)',
        category: 'Injection',
        severity: 'Critical',
        cwe: 'CWE-89',
        cvss: '9.8',
        owasp: 'A03:2021 Injection',
        url: '/api/products?category=1',
        method: 'GET',
        parameter: 'category',
        tags: ['sql', 'injection', 'blind', 'boolean', 'database'],
        description: '<p>The application is vulnerable to blind boolean-based SQL injection. Although the application does not directly display database error messages or query results in its responses, it exhibits different behavior depending on whether the injected SQL condition evaluates to TRUE or FALSE.</p><p>By systematically injecting conditional SQL expressions and observing the application\'s response (e.g., different page content, HTTP status codes, or response sizes), an attacker can extract data from the database one bit at a time. Automated tools such as sqlmap can fully exploit this vulnerability to dump the entire database contents.</p><p>This technique is slower than UNION-based injection but equally dangerous, as it ultimately allows complete database extraction given sufficient time.</p>',
        impact: '<p>The impact mirrors that of standard SQL injection:</p><ul><li><strong>Full Database Extraction:</strong> Despite the "blind" nature, attackers can systematically extract all database contents including usernames, password hashes, API keys, and business-critical data.</li><li><strong>Administrative Access:</strong> Extracted credentials can be used to gain administrative access to the application and potentially the underlying server infrastructure.</li><li><strong>Data Manipulation:</strong> Depending on database permissions, attackers may modify or delete records, potentially disrupting business operations.</li><li><strong>Lateral Movement:</strong> Database credentials or connection strings may enable access to other systems in the network.</li></ul>',
        remediation: '<p>Apply the same countermeasures as for standard SQL injection:</p><ol><li><strong>Parameterized Queries:</strong> Replace all dynamically constructed SQL queries with prepared statements using parameterized placeholders.</li><li><strong>Stored Procedures:</strong> Where appropriate, use stored procedures with parameterized inputs to abstract SQL logic from the application layer.</li><li><strong>Input Validation:</strong> Implement strict allowlist-based input validation on all user-controllable parameters before they reach the database layer.</li><li><strong>Error Handling:</strong> Ensure consistent error responses that do not leak information about the database structure. Use generic error pages for all error conditions.</li><li><strong>Database Activity Monitoring:</strong> Implement database query logging and anomaly detection to identify and alert on injection attempts.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: SQL Injection</a></li><li><a href="https://portswigger.net/web-security/sql-injection/blind">PortSwigger - Blind SQL Injection</a></li></ul></p>',
    },
    {
        id: 'inj-sql-blind-time',
        title: 'SQL Injection (Blind Time-Based)',
        category: 'Injection',
        severity: 'Critical',
        cwe: 'CWE-89',
        cvss: '9.8',
        owasp: 'A03:2021 Injection',
        url: '/api/search?q=test',
        method: 'GET',
        parameter: 'q',
        tags: ['sql', 'injection', 'blind', 'time-based', 'database'],
        description: '<p>The application is vulnerable to time-based blind SQL injection. The attacker can inject SQL expressions that cause the database to pause execution for a specified duration (e.g., using SLEEP(), WAITFOR DELAY, or pg_sleep() functions). By measuring the response time, the attacker can infer whether injected conditions are true or false.</p><p>This technique works even when the application produces identical responses regardless of the query result, making it the most covert form of SQL injection. While slower than boolean-based techniques, it is highly reliable and can be fully automated.</p><p>Testing confirmed that injecting time-delay payloads into the identified parameter consistently produced measurable delays in server response times, confirming the vulnerability.</p>',
        impact: '<p>Time-based blind SQL injection carries the same critical risk as other SQL injection variants:</p><ul><li><strong>Complete Data Extraction:</strong> All database contents can be systematically extracted, though at a slower rate than UNION-based attacks.</li><li><strong>Denial of Service:</strong> Repeatedly triggering long sleep intervals can degrade application performance or cause timeouts, potentially affecting availability for legitimate users.</li><li><strong>Credential Theft:</strong> User credentials, session tokens, and API keys stored in the database can be extracted and used for further attacks.</li></ul>',
        remediation: '<p>Remediation is identical to other SQL injection types:</p><ol><li><strong>Parameterized Queries:</strong> The primary and most effective defense. Ensure all database operations use prepared statements with bound parameters.</li><li><strong>Query Timeout Limits:</strong> Configure the database server to enforce reasonable query execution time limits to mitigate exploitation speed and DoS risk.</li><li><strong>Connection Pooling Limits:</strong> Set maximum connection pool sizes to prevent attackers from exhausting database connections through concurrent time-delay queries.</li><li><strong>WAF Rules:</strong> Configure Web Application Firewall rules to detect and block common time-based injection payloads (SLEEP, WAITFOR, BENCHMARK, pg_sleep).</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/89.html">CWE-89: SQL Injection</a></li><li><a href="https://portswigger.net/web-security/sql-injection/blind">PortSwigger - Blind SQL Injection</a></li></ul></p>',
    },
    {
        id: 'inj-nosql',
        title: 'NoSQL Injection',
        category: 'Injection',
        severity: 'High',
        cwe: 'CWE-943',
        cvss: '8.6',
        owasp: 'A03:2021 Injection',
        url: '/api/login',
        method: 'POST',
        parameter: 'username',
        tags: ['nosql', 'injection', 'mongodb', 'database', 'json'],
        description: '<p>The application uses a NoSQL database (e.g., MongoDB) and constructs queries using unsanitized user input, allowing an attacker to manipulate query logic. Unlike traditional SQL injection, NoSQL injection exploits the query operators and syntax specific to NoSQL databases.</p><p>Common attack vectors include injecting MongoDB query operators such as <code>$gt</code>, <code>$ne</code>, <code>$regex</code>, and <code>$where</code> through JSON parameters or HTTP request fields. For example, submitting <code>{"$ne": ""}</code> as the password field in a login query can bypass authentication by matching all documents where the password is not empty.</p><p>Testing confirmed that injecting NoSQL operators into application parameters altered query behavior, demonstrating that user input is directly incorporated into database queries without sanitization.</p>',
        impact: '<p>The impact of NoSQL injection depends on the database permissions and application architecture:</p><ul><li><strong>Authentication Bypass:</strong> Attackers can bypass login mechanisms by manipulating query conditions, gaining access to any user account.</li><li><strong>Data Exfiltration:</strong> Injected operators can be used to enumerate and extract database documents, including sensitive user data and application secrets.</li><li><strong>Data Manipulation:</strong> If write operations are also vulnerable, attackers may modify or delete database records.</li><li><strong>Server-Side Code Execution:</strong> In cases where the <code>$where</code> operator accepts JavaScript expressions, attackers may achieve server-side code execution.</li></ul>',
        remediation: '<p>To prevent NoSQL injection:</p><ol><li><strong>Input Type Validation:</strong> Strictly validate and enforce expected data types. If a field should be a string, reject objects and arrays. Use schema validation libraries like Joi or Zod.</li><li><strong>Sanitize Input:</strong> Use libraries such as <code>mongo-sanitize</code> or <code>express-mongo-sanitize</code> to automatically strip <code>$</code> and <code>.</code> characters from user input before database operations.</li><li><strong>Use ODM Properly:</strong> When using Mongoose or similar ODMs, leverage built-in schema validation and avoid passing raw user input to query methods.</li><li><strong>Disable Server-Side JavaScript:</strong> Disable the <code>$where</code> operator and <code>mapReduce</code> in production environments to prevent JavaScript injection.</li><li><strong>Principle of Least Privilege:</strong> Configure database users with minimum necessary permissions. Separate read-only and read-write access.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/943.html">CWE-943: Improper Neutralization of Special Elements in Data Query Logic</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html">OWASP Injection Prevention Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'inj-os-command',
        title: 'OS Command Injection',
        category: 'Injection',
        severity: 'Critical',
        cwe: 'CWE-78',
        cvss: '9.8',
        owasp: 'A03:2021 Injection',
        url: '/api/tools/ping',
        method: 'POST',
        parameter: 'host',
        tags: ['command', 'injection', 'rce', 'os', 'shell'],
        description: '<p>The application passes user-supplied input to operating system commands without proper sanitization. This allows an attacker to inject arbitrary shell commands that are executed with the privileges of the web application process.</p><p>The vulnerability typically arises when the application uses functions like <code>exec()</code>, <code>system()</code>, <code>popen()</code>, or backtick operators to execute operating system commands, and includes user input in the command string. By injecting shell metacharacters such as <code>;</code>, <code>|</code>, <code>&&</code>, <code>||</code>, or <code>$()</code>, an attacker can terminate the intended command and append their own.</p><p>This vulnerability effectively grants the attacker Remote Code Execution (RCE) on the server, making it one of the most critical findings in any security assessment.</p>',
        impact: '<p>OS command injection is among the highest-severity vulnerabilities possible:</p><ul><li><strong>Complete Server Compromise:</strong> The attacker can execute arbitrary commands on the server, read and write files, install backdoors, and establish persistent access.</li><li><strong>Data Exfiltration:</strong> Full filesystem access allows the attacker to steal application source code, database credentials, API keys, SSL certificates, and any data stored on the server.</li><li><strong>Lateral Movement:</strong> The compromised server can be used as a pivot point to attack other systems in the internal network.</li><li><strong>Ransomware/Destruction:</strong> The attacker can encrypt or delete critical data and system files.</li><li><strong>Cryptocurrency Mining:</strong> Server resources can be hijacked for unauthorized cryptocurrency mining.</li></ul>',
        remediation: '<p>Command injection must be addressed as an emergency priority:</p><ol><li><strong>Eliminate OS Commands:</strong> The most secure approach is to avoid calling OS commands entirely. Replace shell commands with equivalent language-native library functions (e.g., use built-in file operations instead of calling <code>cp</code> or <code>rm</code>).</li><li><strong>Input Validation:</strong> If OS commands are unavoidable, implement strict allowlist validation. Only permit expected characters (e.g., alphanumeric for filenames). Reject all shell metacharacters.</li><li><strong>Use Safe APIs:</strong> When a command must be executed, use APIs that take arguments as arrays rather than concatenated strings (e.g., <code>subprocess.run([\'cmd\', arg])</code> in Python instead of <code>os.system()</code>).</li><li><strong>Sandboxing:</strong> Run the application in a sandboxed environment with minimal filesystem and network access. Use containerization and seccomp profiles.</li><li><strong>Least Privilege:</strong> Ensure the application process runs under a dedicated user account with minimum necessary permissions.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/78.html">CWE-78: OS Command Injection</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">OWASP OS Command Injection Defense Cheat Sheet</a></li><li><a href="https://portswigger.net/web-security/os-command-injection">PortSwigger - OS Command Injection</a></li></ul></p>',
    },
    {
        id: 'inj-ssti',
        title: 'Server-Side Template Injection (SSTI)',
        category: 'Injection',
        severity: 'Critical',
        cwe: 'CWE-1336',
        cvss: '9.8',
        owasp: 'A03:2021 Injection',
        url: '/profile?name=test',
        method: 'GET',
        parameter: 'name',
        tags: ['ssti', 'template', 'injection', 'rce', 'jinja2', 'twig'],
        description: '<p>The application embeds user input directly into server-side template expressions without proper sanitization. Template engines such as Jinja2 (Python), Twig (PHP), Freemarker (Java), and Pug (Node.js) process these expressions on the server, and when combined with user-controlled input, allow an attacker to execute arbitrary code.</p><p>Template injection can be detected by injecting mathematical expressions like <code>{{7*7}}</code> and observing whether the response contains the evaluated result <code>49</code>. If the expression is evaluated, the attacker can escalate to full Remote Code Execution by accessing template engine internals and the underlying programming language runtime.</p><p>Testing confirmed that template expressions injected through user-controllable parameters are evaluated by the server-side template engine, confirming SSTI vulnerability.</p>',
        impact: '<p>SSTI typically leads to full server compromise:</p><ul><li><strong>Remote Code Execution:</strong> Through template engine object traversal, attackers can access underlying language runtimes to execute arbitrary operating system commands.</li><li><strong>Sensitive Data Access:</strong> Template context variables often include application configuration, database credentials, and other secrets.</li><li><strong>File System Access:</strong> Attackers can read and write arbitrary files on the server.</li><li><strong>Server Takeover:</strong> Full RCE enables persistent backdoor installation and complete system compromise.</li></ul>',
        remediation: '<p>To prevent Server-Side Template Injection:</p><ol><li><strong>Never Embed User Input in Templates:</strong> User input should only be passed as template data/variables, never as part of the template string itself. Use <code>render_template(template_file, variable=user_input)</code> instead of <code>render_template_string(user_input)</code>.</li><li><strong>Sandbox the Template Engine:</strong> If available, enable the template engine\'s sandbox mode (e.g., Jinja2\'s SandboxedEnvironment) to restrict available methods and attributes.</li><li><strong>Input Validation:</strong> Reject input containing template syntax characters like <code>{{ }}</code>, <code>{% %}</code>, <code>${ }</code> where they are not expected.</li><li><strong>Use Logic-less Templates:</strong> Prefer template engines with limited expression capabilities (e.g., Mustache) that cannot access arbitrary objects.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/1336.html">CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine</a></li><li><a href="https://portswigger.net/web-security/server-side-template-injection">PortSwigger - Server-Side Template Injection</a></li></ul></p>',
    },
    {
        id: 'inj-ldap',
        title: 'LDAP Injection',
        category: 'Injection',
        severity: 'High',
        cwe: 'CWE-90',
        cvss: '8.1',
        owasp: 'A03:2021 Injection',
        url: '/auth/login',
        method: 'POST',
        parameter: 'username',
        tags: ['ldap', 'injection', 'directory', 'active-directory', 'authentication'],
        description: '<p>The application constructs LDAP (Lightweight Directory Access Protocol) queries using unsanitized user input. LDAP is commonly used for authentication against Active Directory and other directory services. When user input is incorporated into LDAP filter expressions without proper escaping, an attacker can modify the query logic.</p><p>LDAP injection attacks manipulate filter conditions by injecting special characters such as <code>*</code>, <code>(</code>, <code>)</code>, <code>\\</code>, and <code>NUL</code>. For example, injecting <code>*)(uid=*)</code> into a username field can alter the LDAP filter to return all users, effectively bypassing authentication.</p><p>During testing, it was confirmed that LDAP metacharacters in user input were not properly escaped, allowing modification of LDAP query logic.</p>',
        impact: '<p>LDAP injection can lead to serious security consequences:</p><ul><li><strong>Authentication Bypass:</strong> By manipulating LDAP filter conditions, attackers can authenticate as any user without knowing valid credentials.</li><li><strong>Information Disclosure:</strong> Attackers can enumerate directory entries, extracting usernames, email addresses, group memberships, and organizational structure information.</li><li><strong>Privilege Escalation:</strong> By querying administrative group memberships or modifying queries to return administrator entries, attackers may gain elevated privileges.</li><li><strong>Data Modification:</strong> If the LDAP connection has write permissions, attackers may modify directory entries, change passwords, or alter group memberships.</li></ul>',
        remediation: '<p>To prevent LDAP injection:</p><ol><li><strong>Escape Special Characters:</strong> All user input included in LDAP filters must be escaped using the appropriate LDAP encoding function. Characters that must be escaped include: <code>* ( ) \\ NUL</code>.</li><li><strong>Parameterized LDAP Queries:</strong> Use LDAP libraries that support parameterized queries or prepared filter expressions.</li><li><strong>Input Validation:</strong> Implement strict allowlist validation for fields used in LDAP queries. Usernames should only permit alphanumeric characters and limited special characters.</li><li><strong>Least Privilege:</strong> Configure the LDAP service account with read-only access where write operations are not needed by the application.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/90.html">CWE-90: LDAP Injection</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html">OWASP LDAP Injection Prevention Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'inj-xpath',
        title: 'XPath Injection',
        category: 'Injection',
        severity: 'High',
        cwe: 'CWE-643',
        cvss: '7.5',
        owasp: 'A03:2021 Injection',
        url: '/api/search',
        method: 'POST',
        parameter: 'query',
        tags: ['xpath', 'injection', 'xml', 'authentication'],
        description: '<p>The application constructs XPath queries from user-supplied input without proper sanitization. XPath is a query language for selecting nodes from XML documents and is often used in applications that store data in XML format or use XSLT transformations.</p><p>When user input is directly interpolated into XPath expressions, an attacker can modify the query logic to bypass authentication, extract data, or access unauthorized information. Unlike SQL injection, XPath injection attacks the entire XML document tree, and there is no privilege separation â€” a successful injection can access all data in the XML document.</p><p>Testing revealed that injecting XPath syntax characters into application parameters modified the XPath query behavior, confirming the vulnerability.</p>',
        impact: '<p>XPath injection can have significant impact depending on the application\'s use of XML data:</p><ul><li><strong>Authentication Bypass:</strong> If user credentials are stored in XML and queried via XPath, attackers can bypass login by injecting expressions that always evaluate to true.</li><li><strong>Complete Data Access:</strong> Unlike SQL where access can be restricted by database permissions, XPath has no built-in access control. A successful injection provides access to the entire XML document.</li><li><strong>Information Disclosure:</strong> Attackers can enumerate the XML structure and extract all stored data using blind XPath injection techniques.</li></ul>',
        remediation: '<p>To prevent XPath injection:</p><ol><li><strong>Parameterized XPath Queries:</strong> Use parameterized or precompiled XPath expressions where available. Many XML processing libraries support variable binding in XPath.</li><li><strong>Input Sanitization:</strong> Escape XPath special characters in user input, including: <code>\' " / \\ [ ] ( ) = &lt; &gt;</code>.</li><li><strong>Avoid Dynamic XPath:</strong> Where possible, avoid constructing XPath queries dynamically from user input. Use indexed lookups or database storage for queryable data.</li><li><strong>Input Validation:</strong> Enforce strict format validation on all user inputs used in XPath queries.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP Top 10 - A03:2021 Injection</a></li><li><a href="https://cwe.mitre.org/data/definitions/643.html">CWE-643: Improper Neutralization of Data within XPath Expressions</a></li><li><a href="https://owasp.org/www-community/attacks/XPATH_Injection">OWASP - XPath Injection</a></li></ul></p>',
    },
];
