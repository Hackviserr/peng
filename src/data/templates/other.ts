import type { FindingTemplate } from '../../constants';

export const otherTemplates: FindingTemplate[] = [
    {
        id: 'other-csrf',
        title: 'Cross-Site Request Forgery (CSRF)',
        category: 'Other',
        severity: 'Medium',
        cwe: 'CWE-352',
        cvss: '6.5',
        owasp: 'A01:2021 Broken Access Control',
        url: '/account/settings',
        method: 'POST',
        tags: ['csrf', 'cross-site', 'request-forgery', 'state-changing'],
        description: '<p>The application does not implement adequate Cross-Site Request Forgery protection on state-changing operations. CSRF attacks exploit the browser\'s automatic inclusion of credentials (cookies, HTTP authentication) in requests to the target domain. An attacker can create a web page that triggers state-changing requests to the vulnerable application when visited by an authenticated user.</p><p>The attacker\'s page can contain hidden forms, images, or JavaScript that automatically submit requests to the application. Because the browser automatically includes the user\'s session cookie, the application processes these requests as legitimate, performing the action on behalf of the victim without their knowledge or consent.</p><p>Testing confirmed that state-changing operations (POST, PUT, DELETE) can be triggered from external origins without CSRF token validation.</p>',
        impact: '<ul><li><strong>Unauthorized Actions:</strong> Attackers can force authenticated users to perform any state-changing action: password changes, email changes, money transfers, data deletion, or configuration changes.</li><li><strong>Account Takeover:</strong> If email or password change functions are vulnerable, CSRF can be chained for full account takeover.</li><li><strong>Data Manipulation:</strong> User data, settings, and content can be modified without the user\'s knowledge.</li></ul>',
        remediation: '<ol><li><strong>CSRF Tokens:</strong> Implement synchronizer token pattern: generate a unique, unpredictable CSRF token per session or per request, include it as a hidden field or header, and validate it server-side on all state-changing requests.</li><li><strong>SameSite Cookies:</strong> Set <code>SameSite=Strict</code> or <code>SameSite=Lax</code> on session cookies to prevent cross-origin submission.</li><li><strong>Double Submit Cookie:</strong> As an alternative to server-side tokens, use the double-submit cookie pattern where a random value is sent in both a cookie and a request parameter.</li><li><strong>Origin/Referer Validation:</strong> Verify the <code>Origin</code> or <code>Referer</code> header on state-changing requests as an additional defense layer.</li><li><strong>Custom Headers:</strong> For API endpoints, require custom headers (e.g., <code>X-Requested-With</code>) that cannot be sent cross-origin without CORS preflight.</li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 - A01:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/352.html">CWE-352: Cross-Site Request Forgery</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">OWASP CSRF Prevention Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'other-clickjacking',
        title: 'Clickjacking (UI Redressing)',
        category: 'Other',
        severity: 'Medium',
        cwe: 'CWE-1021',
        cvss: '4.7',
        owasp: 'A01:2021 Broken Access Control',
        url: '/account/settings',
        method: 'GET',
        tags: ['clickjacking', 'iframe', 'ui-redressing', 'x-frame-options'],
        description: '<p>The application can be loaded within an iframe on an attacker-controlled web page. This allows an attacker to overlay the application with transparent or visually disguised elements, tricking users into clicking on application buttons or links while believing they are interacting with the attacker\'s page.</p><p>Clickjacking attacks can be used to trick users into performing actions such as enabling webcam/microphone access, liking social media content, clicking "delete" or "confirm" buttons, or changing security settings. The attack is particularly effective because the user\'s click is directly processed by the legitimate application.</p><p>Testing confirmed that the application\'s pages can be successfully embedded in iframes on external domains, as neither <code>X-Frame-Options</code> nor <code>Content-Security-Policy: frame-ancestors</code> headers are present.</p>',
        impact: '<ul><li><strong>Unauthorized Actions:</strong> Users can be tricked into performing state-changing actions without their knowledge.</li><li><strong>Social Engineering:</strong> The trusted appearance of the application within the attacker\'s page enhances social engineering effectiveness.</li><li><strong>Data Theft:</strong> Clickjacking can be combined with drag-and-drop techniques to extract data from the application.</li></ul>',
        remediation: '<ol><li><strong>X-Frame-Options Header:</strong> Add <code>X-Frame-Options: DENY</code> or <code>X-Frame-Options: SAMEORIGIN</code> to all responses.</li><li><strong>CSP frame-ancestors:</strong> Use <code>Content-Security-Policy: frame-ancestors \'self\'</code> for more flexible control over framing permissions.</li><li><strong>JavaScript Frame-Busting:</strong> As a fallback for older browsers, implement frame-busting JavaScript: <code>if (window.top !== window.self) { window.top.location = window.location; }</code></li></ol>',
        references: '<p><ul><li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 - A01:2021</a></li><li><a href="https://cwe.mitre.org/data/definitions/1021.html">CWE-1021: Improper Restriction of Rendered UI Layers</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html">OWASP Clickjacking Defense Cheat Sheet</a></li></ul></p>',
    },
    {
        id: 'other-open-redirect',
        title: 'Open Redirect',
        category: 'Other',
        severity: 'Low',
        cwe: 'CWE-601',
        cvss: '4.7',
        owasp: 'A01:2021 Broken Access Control',
        url: '/redirect?url=https://evil.com',
        method: 'GET',
        parameter: 'url',
        tags: ['redirect', 'open-redirect', 'phishing', 'url'],
        description: '<p>The application accepts user-controllable input to determine the destination of HTTP redirects without proper validation. This allows an attacker to construct URLs that appear to be on the trusted domain but redirect users to attacker-controlled websites.</p><p>Open redirects are commonly found in login flows (<code>/login?redirect=https://evil.com</code>), logout pages, OAuth callbacks, and any endpoint that accepts a URL parameter for redirection purposes.</p><p>Testing confirmed that manipulating redirect-related parameters caused the application to redirect users to external, attacker-controlled domains.</p>',
        impact: '<ul><li><strong>Phishing:</strong> Attackers can create convincing phishing URLs that start with the trusted domain, bypassing user vigilance and email security filters.</li><li><strong>Credential Theft:</strong> Users redirected to a cloned login page on the attacker\'s domain may enter their credentials.</li><li><strong>Malware Distribution:</strong> Users can be redirected to pages hosting malware or exploit kits.</li><li><strong>OAuth Token Theft:</strong> In OAuth flows, open redirects can be used to steal authorization codes or tokens.</li></ul>',
        remediation: '<ol><li><strong>Avoid User-Controlled Redirects:</strong> Where possible, eliminate redirect URL parameters entirely. Use server-side redirect mappings instead.</li><li><strong>Allowlist Validation:</strong> Validate redirect URLs against a strict allowlist of permitted domains and paths.</li><li><strong>Relative URLs Only:</strong> If redirects must use user input, only allow relative URL paths (starting with <code>/</code>) and reject absolute URLs or protocol-relative URLs (<code>//evil.com</code>).</li><li><strong>Interstitial Warning:</strong> If redirecting to external sites is a legitimate feature, display an interstitial page warning the user they are leaving the site.</li></ol>',
        references: '<p><ul><li><a href="https://cwe.mitre.org/data/definitions/601.html">CWE-601: URL Redirection to Untrusted Site</a></li><li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">OWASP Unvalidated Redirects Cheat Sheet</a></li></ul></p>',
    },
];
